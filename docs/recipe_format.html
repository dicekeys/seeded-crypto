<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiceKeys Seeded Cryptography Library: JSON Format for Recipes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DiceKeys Seeded Cryptography Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('recipe_format.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">JSON Format for Recipes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__Users_stuart_git_dicekeys_seeded_crypto_doxygen_JSON_Format_for_Derivation_Options"></a> This JSON-format format specifies the recipes for deriving secrets (<a class="el" href="class_secret.html" title="A secret derived from a seed string and set of derivation specified options in JSON Format for Recipe...">Secret</a>), keys (<a class="el" href="class_symmetric_key.html" title="A SymmetricKey can be used to seal and unseal messages. This SymmetricKey class can be (re) derived f...">SymmetricKey</a>) and key pairs (<a class="el" href="class_unsealing_key.html" title="an UnsealingKey is used to unseal messages sealed with its corresponding SealingKey....">UnsealingKey</a> &amp; <a class="el" href="class_sealing_key.html" title="A sealingKeyBytes is used to seal messages, in combination with a UnsealingKey which can unseal them....">SealingKey</a>, <a class="el" href="class_signing_key.html" title="SigningKeys generate signatures of messages which can then be used by the corresponding SignatureVeri...">SigningKey</a> &amp; <a class="el" href="class_signature_verification_key.html" title="A SignatureVerificationKey is used to verify that messages were signed by its corresponding SigningKe...">SignatureVerificationKey</a>) from a seed string.</p>
<p>For example, the following is a valid <a class="el" href="class_recipe.html" title="This class parses a recipe string on construction and then exposes the Recipe JSON Universal Fields a...">Recipe</a> JSON string used to generate a <a class="el" href="class_symmetric_key.html" title="A SymmetricKey can be used to seal and unseal messages. This SymmetricKey class can be (re) derived f...">SymmetricKey</a>, using the <code>Argon2id</code> to derive the key bytes from a seed string:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;SymmetricKey&quot;,</div>
<div class="line">    &quot;hashFunction&quot;: &quot;Argon2id&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The value of a recipe JSON string must be either a valid JSON object specification, which is a set of fields enclosed in curly braces ("{}") per the JSON format, or an empty string.</p>
<p>This specification defines default values for <em>all</em> fields, these defaults are used when a field is absent, and so a recipe JSON string that is itself an empty string ("") or empty object ("{}") will use defaults for all field values. For example, If you are deriving a <a class="el" href="class_symmetric_key.html" title="A SymmetricKey can be used to seal and unseal messages. This SymmetricKey class can be (re) derived f...">SymmetricKey</a> and pass the empty string, the <code>"type"</code> will be inferred to be <code>Symmetric</code>, the <code>"hashFunction"</code> to be <code>BLAKE2b</code>, and the <code>"algorithm"</code> will be the default algorithm for symmetric key cryptography: <code>XSalsa20Poly1305</code>.</p>
<p>The Seeded Cryptography Library uses a hash function to derive keys and secrets, and the input to that hash function includes both the seed string <em>and</em> the JSON string you provide with the recipe. In cryptographic terms, this means the JSON string with your recipe is used to <em>salt</em> the hash function. Thus, <em>any</em> change to this <a class="el" href="class_recipe.html" title="This class parses a recipe string on construction and then exposes the Recipe JSON Universal Fields a...">Recipe</a> JSON string, even if just ordering or white space, will cause a different key or secret to be derived.</p>
<p>Any fields in your JSON object that are not in this specification have no effect other than to change the input to the hash function and thus the derived key or secret. This allows other libraries to extend the spec without making changes to how this library derives keys and secrets. Those using the library can also embed arbitrary fields into the JSON object as they see fit. For example, the second field in the object specified by the following JSON string is not processed by the library, but since the entire string is passed to the hash function used to derive the key it ensure a different key will be derived than if the field were absent:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;SymmetricKey&quot;,</div>
<div class="line">    &quot;aRandomNumericSaltNotInTheSpec&quot;: 1299486243</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1"></a>
How this specification is organized</h3>
<p>This specification separates the JSON object fields into three categories:</p>
<p><em>Universal fields</em> are used by the Seeded Cryptography Library directly to derive secrets and key seeds. These are generalizable to any type of seed string, not just the DiceKeys use case for which we created this library.</p>
<p>The Seeded Cryptography Library is oblivious to other fields, but since they are part of the JSON string any changes to them will cause the library to derive a different key.</p>
<p><em>DiceKeys Hardware fields</em> apply to keys seeded with a DiceKeys.</p>
<p><em>Authentication and Authorization Requirements</em> apply to keys generated through the DiceKeys API, which calls uses the DiceKeys app to generate keys and often to perform cryptographic operations. The DiceKeys app protects the keys so that other applications are not able to see the raw DiceKey, and these options specify which applications are allowed to generate keys and what they are allowed to do with them.</p>
<p><a class="anchor" id="derivation_options_universal_fields"></a></p>
<h2><a class="anchor" id="autotoc_md2"></a>
Universal Fields used by the Seeded Cryptography Library</h2>
<p>The following fields are inspected and used by the seeded-crypto C++ library.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
type</h3>
<p>Specify whether this JSON object should be used to construct a <a class="el" href="class_secret.html">Secret</a>, <a class="el" href="class_symmetric_key.html">SymmetricKey</a>, <a class="el" href="class_unsealing_key.html">UnsealingKey</a>, or <a class="el" href="class_signing_key.html">SigningKey</a>.</p>
<div class="fragment"><div class="line">&quot;type&quot;?:</div>
<div class="line">    // For constructing a password</div>
<div class="line">    &quot;Password&quot; |</div>
<div class="line">    // For constructing a raw Secret</div>
<div class="line">    &quot;Secret&quot; |</div>
<div class="line">    // For constructing a SymmetricKey</div>
<div class="line">    &quot;SymmetricKey&quot; |</div>
<div class="line">    // For constructing an UnsealingKey, from which a corresponding SealingKey can be instantiated</div>
<div class="line">    &quot;UnsealingKey&quot; |</div>
<div class="line">    // For constructing a SigningKey, from which a SignatureVerificationKey can be instantiated</div>
<div class="line">    &quot;SigningKey&quot;</div>
</div><!-- fragment --><p>Instead of a generic Public and Private asymmetric key, we support separate key pairs for sealing (encrypting and integrity-protecting) messages, <a class="el" href="class_sealing_key.html" title="A sealingKeyBytes is used to seal messages, in combination with a UnsealingKey which can unseal them....">SealingKey</a> &amp; <a class="el" href="class_unsealing_key.html" title="an UnsealingKey is used to unseal messages sealed with its corresponding SealingKey....">UnsealingKey</a>, and for digital signatures, the <a class="el" href="class_signing_key.html" title="SigningKeys generate signatures of messages which can then be used by the corresponding SignatureVeri...">SigningKey</a> &amp; <a class="el" href="class_signature_verification_key.html" title="A SignatureVerificationKey is used to verify that messages were signed by its corresponding SigningKe...">SignatureVerificationKey</a>. The <code>type</code> for an asymmetric key pair is the type of the private key, as you can obtain a public <a class="el" href="class_signature_verification_key.html" title="A SignatureVerificationKey is used to verify that messages were signed by its corresponding SigningKe...">SignatureVerificationKey</a> from the private <a class="el" href="class_signing_key.html" title="SigningKeys generate signatures of messages which can then be used by the corresponding SignatureVeri...">SigningKey</a>, and you can obtain the public <a class="el" href="class_sealing_key.html" title="A sealingKeyBytes is used to seal messages, in combination with a UnsealingKey which can unseal them....">SealingKey</a> from the private <a class="el" href="class_unsealing_key.html" title="an UnsealingKey is used to unseal messages sealed with its corresponding SealingKey....">UnsealingKey</a>.</p>
<p>If this field is not provided, the type is inferred from the type of object being constructed.</p>
<p>If you attempt to construct an object of one <code>type</code> when the <code>"type"</code> field specifies a different <code>type</code>, the constructor will throw an <a class="el" href="class_invalid_derivation_option_value_exception.html">InvalidDerivationOptionValueException</a>.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
algorithm</h3>
<p>Specify the specific algorithm to use.</p>
<div class="fragment"><div class="line">&quot;algorithm&quot;?: </div>
<div class="line">    // valid only for &quot;type&quot;: &quot;SymmetricKey&quot;</div>
<div class="line">    &quot;XSalsa20Poly1305&quot; | // the default for SymmetricKey</div>
<div class="line">    // valid only for &quot;type&quot;: &quot;UnsealingKey&quot;</div>
<div class="line">    &quot;X25519&quot; |           // the default for UnsealingKey</div>
<div class="line">    // valid only for &quot;type&quot;: &quot;SigningKey&quot;</div>
<div class="line">    &quot;Ed25519&quot;            // the default for SigningKey</div>
</div><!-- fragment --><p>The <code>algorithm</code> field should never be set when <code>"type": "Secret"</code> or <code>"type": "Password"</code>.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
lengthInBytes</h3>
<div class="fragment"><div class="line">&quot;lengthInBytes&quot;?: number // e.g. &quot;lengthInBytes&quot;: 32</div>
</div><!-- fragment --><p>Use this field when <code>"type": "Secret"</code> to set the size of the secret to be derived (in bytes, as the name implies). If set for other derived object <code>type</code>, it must the value assigned must match the lengthInBytes of that algorithm (32 bytes for the algorithms currently supported).</p>
<p>If this library is extended to support <code>algorithm</code> values with multiple key-length options, this field will be used to specify which length variant of the algorithm to use.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
lengthInBits</h3>
<div class="fragment"><div class="line">&quot;lengthInBits&quot;?: number</div>
</div><!-- fragment --><p>Use this field when <code>"type": "<a class="el" href="class_password.html" title="A secret derived from a seed string and set of derivation specified options in JSON Format for Recipe...">Password</a></code> to set the required minimum bit strength of the password. For example, if using a 512 word list (9 bits) and setting this value to 95, an 11-word password (99 bit) password will be generated.</p>
<p>If neither this field nor <code>lengthInWords</code> is set, the default lengthInBits for a password will be 128.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
lengthInChars</h3>
<div class="fragment"><div class="line">&quot;lengthInChars&quot;?: number</div>
</div><!-- fragment --><p>Use this field when <code>"type": "<a class="el" href="class_password.html" title="A secret derived from a seed string and set of derivation specified options in JSON Format for Recipe...">Password</a></code> to set the maximum number of characters to generate.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
lengthInWords</h3>
<div class="fragment"><div class="line">&quot;lengthInWords&quot;?: number</div>
</div><!-- fragment --><p>Use this field when <code>"type": "<a class="el" href="class_password.html" title="A secret derived from a seed string and set of derivation specified options in JSON Format for Recipe...">Password</a></code> to set the required minimum number of words from a word list to join together to form a password.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
wordList</h3>
<div class="fragment"><div class="line">&quot;wordList&quot;?:  &quot;EN_512_words_5_chars_max_ed_4_20200917&quot; | &quot;EN_1024_words_6_chars_max_ed_4_20200917&quot;</div>
</div><!-- fragment --><p>Use this field when <code>"type": "<a class="el" href="class_password.html" title="A secret derived from a seed string and set of derivation specified options in JSON Format for Recipe...">Password</a></code> to set the word list to be used to create a password from the binary secret. Defaults to <code>"EN_512_words_5_chars_max_ed_4_20200917"</code>, a 512-word list of words of max length 5 characters all of which are at least an edit distance of four from every other word on the list.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
hashFunction</h3>
<p>The <code>hashFunction</code> field specifies the hash function to used to derive key seeds and secrets. The default is <code>"BLAKE2b"</code>.</p>
<div class="fragment"><div class="line">&quot;hashFunction&quot;?: &quot;BLAKE2b&quot; | &quot;Argon2id&quot;</div>
</div><!-- fragment --><p><code>Argon2id</code> is a hash function designed to require not just computation, but also memory, in order to thwart hardware brute force attacks.[^1]. To derive secrets, the password parameter is set to the seed and the salt parameter is set to the concatenation of the type string ("Password", "Secret", "SymmetricKey", "UnsealingKey" or "SigningKey") followed by the recipe JSON string. No null terminators or other separators are used. The implementation uses the <code>argon2id_hash_raw</code> function internal to libsodium. with When using <code>Argon2id</code>, you can also specify the memory limit and the number of passes to make through memory.</p>
<p><code>BLAKE2b</code> applies the BLAKE2b hash function as the building block for HKDF function (<a href="https://tools.ietf.org/html/rfc5869">RFC5869</a>) to allow for arbitrary-length outputs. We set the HKDF input keying material (<code>IKM</code> parameter) to the seed string and the <code>info</code> parameter set to the concatenation of the type string ("Password", "Secret", "SymmetricKey", "UnsealingKey" or "SigningKey") followed by the recipe JSON string. We using BLAKE2b with a 32-byte output block as the underlying HMAC. The implementation uses the <code>crypto_generichash_blake2b</code> series of functions in libsodium) function with a 32 byte block and 32 0s for the <code>salt</code> used when deriving the <code>PRK</code> (see Step 1 in Section 2.2 of the <a href="https://tools.ietf.org/html/rfc5869">HKDF spec</a>).</p>
<div class="fragment"><div class="line">&quot;hashFunctionMemoryLimitInBytes&quot;: number // default 67108864</div>
<div class="line">&quot;hashFunctionMemoryPasses&quot;: number // default 2</div>
</div><!-- fragment --><p>The <code>hashFunctionMemoryLimitInBytes</code> field is the amount of memory that <code>Argon2id</code> will be required to iterate (pass) through in order to compute the correct output (it will be rounded down to the nearest kilobyte), and <code>hashFunctionMemoryPasses</code> is the number of passes it will need to make through that memory to do so.</p>
<p>For example: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;Secret&quot;,</div>
<div class="line">    &quot;lengthInBytes&quot;: 96,</div>
<div class="line">    &quot;hashFunction&quot;: &quot;Argon2id&quot;,</div>
<div class="line">    &quot;hashFunctionMemoryLimitInBytes&quot;: 67108864,</div>
<div class="line">    &quot;hashFunctionMemoryPasses&quot;: 4</div>
<div class="line">}</div>
</div><!-- fragment --><p>As the name implies, the <code>hashFunctionMemoryLimitInBytes</code> field is specified in bytes. It should be a multiple of 1,024, must be at least 8,192 and no greater than 2^31 (2,147,483,648). The default is 67,108,864. This field maps to the <a href="https://libsodium.gitbook.io/doc/password_hashing/default_phf"><code>memlimit</code> parameter in libsodium</a>.</p>
<p>The <code>hashFunctionMemoryPasses</code> must be at least 1, no greater than 2^32-1 (4,294,967,295), and is set to 2 memory passes by default. Since this parameter determines the number of passes the hash function will make through the memory region specified by <code>hashFunctionMemoryLimitInBytes</code>, and results in hashing an amount of memory equal to the product of these two parameters, the computational cost is on the order of the product of <code>hashFunctionMemoryPasses</code> times <code>hashFunctionMemoryLimitInBytes</code>. (The <code>hashFunctionMemoryPasses</code> field maps to the poorly-documented <code>opslimit</code> in <code>libsodium</code>. An examination of the source shows that opslimit is assigned to a parameter named <code>t_cost</code>, which in turn is assigned to <code>instance.passes</code> on line 56 of <a href="https://github.com/jedisct1/libsodium/blob/7214dff083638604cd48e5c9ffc5704460192794/src/libsodium/crypto_pwhash/argon2/argon2.c">argon2.c</a>.)</p>
<p>Since <code>BLAKE2b</code> is a single-iteration function, the <code>hashFunctionMemoryLimitInBytes</code> and <code>hashFunctionMemoryPasses</code> fields must not be set when it is used.</p>
<h4><a class="anchor" id="autotoc_md11"></a>
Hash defaults and recommendations</h4>
<p>The default hash function is <code>BLAKE2b</code> as this library was designed for DiceKeys, which are random and drawn from such a large number of possible values (~2^196) to make <code>Argon2id</code> unnecessary. This default ensures that keys can be re-derived cheaply on just about any hardware platform.</p>
<p>Applications that need a more expensive key derivation to protect against brute-forcing of the derivation algorithm will want to use <code>Argon2id</code>.</p>
<p>We purposely chose <em>not</em> to support multiple iterations of <code>BLAKE2b</code> via the <code>hashFunctionMemoryPasses</code> field, as applications that want to increase the cost of key derivation to prevent brute forcing should use <code>Argon2id</code>.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
DiceKeys Hardware Fields</h2>
<p>This Seeded Cryptography Library is oblivious to these fields, but they are documented here to keep the specification from being split into too many locations.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
excludeOrientationOfFaces</h3>
<p>When using a DiceKey as a seed, the default seed string will be a 75-character string consisting of triples for each die in canonical order: 1 The uppercase letter on the die 2 The digit on the die 3 The orientation relative to the top of the square in canonical form</p>
<p>If <code>excludeOrientationOfFaces</code> is set to <code>true</code>, the orientation character (the third member of each triple) will be set to "?" before the canonical form is determined (the choice of the top left corner that results in the human readable form earliest in the sort order) and "?" will be the third character in each triple.</p>
<p>This option exists because orientations may be harder for users to copy correctly than letters and digits are. With this option on, should a user choose to manually copy the contents of a DiceKey and make an error in copying an orientation, that error will not prevent them from re-deriving the specified key or secret.</p>
<div class="fragment"><div class="line">&quot;excludeOrientationOfFaces&quot;?: true | false // default false</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Authentication and Authorization Requirements</h2>
<p>These fields specify who may generate keys and what they may do with them once generated.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
allow</h3>
<p>The most universal form of identifying apps and services is via components of <a href="https://en.wikipedia.org/wiki/URL">URL</a>s: origins and paths. The web, iOS, and Android all provide a means for one app to contact another website or on-device application by issuing an HTTPS request to a resource identified via an HTTPS URL, which will fail unless the operating system or browser is able to authenticate the recipient. For intra-browser communication between web-apps, communication via postMessage provides authentication via origins. Thus, the default way to restrict the use of a derived key or secret is via these web standards using the <code>allow</code> field.</p>
<div class="fragment"><div class="line">&quot;allow&quot;?: {&quot;host&quot;: string, &quot;paths&quot;?: string[]}[]</div>
</div><!-- fragment --><p>A request is allowed if any of the entries in the array matches the host and one of the paths from an entry in the list.</p>
<p>The specification uses hosts and not origins as the scheme must always be "https://". Unless a custom port is in use, the host field is the same as the hostname (e.g. "example.com"). If the host field starts with "*.", then any subdomain will match, as will the domain that follows the "*." prefix. So, "*.example.com" is satisfied by both "sub.example.com" and "example.com."</p>
<p>For URL-based APIs (those where messages are passed via page loads, as opposed to postMessage requests), the path of the URL to which the response will be sent must match one of the paths in the <code>paths</code> field. Path specifications may end in "*", in which case the path must start with the prefix before the "*". For example, "https://example.com/iamgroot" satisfies path "/iam\*". All paths must start with a "/" per web specifications, but if you forget to include the "/" the validator will assume you intended to include it. If you do not specify a <code>paths</code> field, the default of <code>["/--derived-secret-api--/*"]</code>.</p>
<p>If the <code>allow</code> clause is not satisfied, the DiceKeys app must not send the response (unless it is allowed by <code>androidPackagePrefixesAllowed</code>, below).</p>
<p>Example:</p>
<div class="fragment"><div class="line">&quot;allow&quot;: [</div>
<div class="line">    {&quot;host&quot;: &quot;dicekeys.org&quot;, &quot;paths&quot;: [&quot;/app/fido*&quot;]},</div>
<div class="line">    {&quot;host&quot;: &quot;dicekeys.com&quot;, &quot;paths&quot;: [&quot;/app/fido*&quot;]}</div>
<div class="line">]</div>
</div><!-- fragment --><p>By default, this field is unset and any client may use the key (though the seal operation supports UnsealingInstructions that include <code>allow</code>, protecting against data being unsealed and read by unauthorized clients.)</p>
<p>Alas, issuing a request via an HTTPS url only allows the client to authenticate the server. Operating systems like iOS do not provide support for the DiceKeys app receiving a request to authenticate the client. Rather, the app can only ensure that the response is sent to one of the authorized URLs. Attackers, and other clients that are not authorized, can issue requests and have keys, unsealed messages, or other data sent to the prefixes you authorize. The apps and services you offer at those prefixes must be written to throw out responses to requests that they did not issue, and do so without leaking any data to attackers.</p>
<p>Our DiceKeys client APIs generate 128-bit random request ID using APIs designed for cryptographic randomness, and throw out responses for requests from IDs that they did not issue, and so are designed to protect against such attacks. Further, operations performed by the DiceKeys app in response to API requests do not have side effects, beyond causing the user to load in their DiceKey if needed and respond to requests.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
requireAuthenticationHandshake</h3>
<p>To harden your app against unauthorized client requests, you can set the <code>requireAuthenticationHandshake</code> field. </p><div class="fragment"><div class="line">&quot;requireAuthenticationHandshake&quot;?: boolean</div>
</div><!-- fragment --><p>Since the default is false, the only reason to include this field in your recipe is to set it to true.</p>
<div class="fragment"><div class="line">&quot;requireAuthenticationHandshake&quot;: true</div>
</div><!-- fragment --><p>When set, clients will need to issue a handshake request to the API, and receive an authorization token (a random shared secret), before issuing other requests where the URL at which they received the token starts with one of the authorized prefixes. The DiceKeys app will map the authorization token to that URL and, when requests include that token, validate that the URL associated with the token has a valid prefix. The DiceKeys app will continue to validate that responses are also sent to a valid prefix.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
androidPackagePrefixesAllowed</h3>
<p>While the Android platform supports issuing requests and receiving responses via URLs, the platform has better support for authentication via application package names. Specifically, an application receiving an explicit intent issued to its package receives an OS-validated package name of the client. Authenticating clients via packages does not require a handshake, is faster, and potentially more secure.</p>
<p>If <code>androidPackagePrefixesAllowed</code> is set to a list of package prefixes, clients may contact the DiceKeys app on Android without going through the URL interface, need not have a URL on the <code>allow</code> list, and need not use a handshake even if <code>requireAuthenticationHandshake</code> is set to true. If this value is set, <code>allow</code> should always be set, even if to an empty list.</p>
<div class="fragment"><div class="line">&quot;androidPackagePrefixesAllowed&quot;?: string[],</div>
</div><!-- fragment --><p>For example: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;Secret&quot;,</div>
<div class="line">    &quot;androidPackagePrefixesAllowed&quot;: [</div>
<div class="line">        &quot;org.dicekeys.apps.fido&quot;,</div>
<div class="line">        &quot;com.dicekeys.apps.fido&quot;</div>
<div class="line">    ],</div>
<div class="line">    &quot;allow&quot;: [</div>
<div class="line">        {&quot;host&quot;: &quot;dicekeys.org&quot;, &quot;paths&quot;: [&quot;/app/fido&quot;]},</div>
<div class="line">        {&quot;host&quot;: &quot;dicekeys.com&quot;, &quot;paths&quot;: [&quot;/app/fido&quot;]}</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The API will terminate prefixes set via "`androidPackagePrefixesAllowed`" with dots, and and terminate client package IDs with dots, to prevent extension attacks. In other words, if you set the prefix <code>com.example</code>, the API will test if <code>com.example.</code> is a prefix of the string composed by concatenating a period onto your client application's package name. So, if an attacker registers the package name <code>com.exampleattacker</code>, they will not be able to match the <code>com.example</code> prefix.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;requireUsersConsent&quot;: {</div>
<div class="line">        &quot;question&quot;: &quot;Do you want use \&quot;8fsd8pweDmqed\&quot; as your SpoonerMail account password and remove your current password?&quot;,</div>
<div class="line">        &quot;actionButtonLabels&quot;: {</div>
<div class="line">            &quot;allow&quot;: &quot;Make my password \&quot;8fsd8pweDmqed\&quot;&quot;,</div>
<div class="line">            &quot;deny&quot;: &quot;No&quot; </div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
clientMayRetrieveKey</h3>
<p>By default, the DiceKeys app will forbid clients from retrieving a <a class="el" href="class_signing_key.html" title="SigningKeys generate signatures of messages which can then be used by the corresponding SignatureVeri...">SigningKey</a>, <a class="el" href="class_symmetric_key.html" title="A SymmetricKey can be used to seal and unseal messages. This SymmetricKey class can be (re) derived f...">SymmetricKey</a>, or <a class="el" href="class_unsealing_key.html" title="an UnsealingKey is used to unseal messages sealed with its corresponding SealingKey....">UnsealingKey</a> even when all authentication restrictions (e.g., <code>allow</code>) are met.</p>
<p>To derive keys that an authorized client will be permitted to retrieve, use the <code>clientMayRetrieveKey</code> field.</p>
<div class="fragment"><div class="line">&quot;clientMayRetrieveKey&quot;?: boolean</div>
</div><!-- fragment --><p>Since the default is false, it is primarily used as follows:</p>
<div class="fragment"><div class="line">&quot;clientMayRetrieveKey&quot;: true</div>
</div><!-- fragment --><p>Clients can use this field to generate keys that they can get a copy of, use for any purpose they want without having to interact with the DiceKeys API or app, yet which they can ask the DiceKeys app to recover for them should the key be lost. For example, an end-to-end encrypted app could generate a key pair it uses for communication and storage, keep the key locally, but ask the DiceKeys app to re-derive it if the user is recovering their data on a new device. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
